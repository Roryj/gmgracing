{"version":3,"sources":["app/shop/magento.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../public/js/shop.js","sourcesContent":["var app = angular.module('GmgStoreApp', ['ngCookies', 'localytics.directives']).config([\n    '$parseProvider', function($parseProvider) {\n      return $parseProvider.unwrapPromises(true);\n    }\n  ]);\n\nvar api_path = \"/store/api-v1\";\njQuery.cookie.json = true;\njQuery.cookie.defaults.expires = 7\njQuery.cookie.defaults.path = \"/\";\n\napp.config(['$httpProvider', function ($httpProvider) {\n    $httpProvider.defaults.transformRequest = function(d, headers){\n      jQuery('.loading-animation').addClass('loading');\n    }\n    \n    var $http,\n        interceptor = ['$q', '$injector', function ($q, $injector) {\n            var error;\n\n            function success(response) {\n                // get $http via $injector because of circular dependency problem\n                $http = $http || $injector.get('$http');\n                if($http.pendingRequests.length < 1) {\n                    jQuery('.loading-animation').removeClass('loading');\n                }\n                return response;\n            }\n\n            function error(response) {\n                // get $http via $injector because of circular dependency problem\n                $http = $http || $injector.get('$http');\n                if($http.pendingRequests.length < 1) {\n                    jQuery('.loading-animation').removeClass('loading');\n                }\n                return $q.reject(response);\n            }\n\n            return function (promise) {\n                jQuery('.loading-animation').addClass('loading');\n                return promise.then(success, error);\n            }\n        }];\n\n    $httpProvider.responseInterceptors.push(interceptor);\n}]);\n\napp.controller('GmgStoreCtrl', function ($rootScope, $http, $timeout) {\n  $rootScope.yearOptions = [];\n  $rootScope.makeOptions = [];\n  $rootScope.modelOptions = [];\n  $rootScope.categories = [];\n\n  $rootScope.filter = {};\n  $rootScope.filterYear = {};\n  $rootScope.filterMake = {};\n  $rootScope.filterModel = {};\n\n  if (jQuery.cookie('filter')){\n    $rootScope.filter = jQuery.cookie('filter');\n    $rootScope.selected_car = $rootScope.filter.year + ' ' + $rootScope.filter.make + ' ' + $rootScope.filter.model;\n  }\n\n  $rootScope.is_selected_category = function(category){\n    var filter = jQuery.cookie('filter');\n    return category.id == filter.category\n  }\n\n  find_object = function(collection, id){\n    return _.find(collection, function(obj){\n      return obj.id == id;\n    });\n  }\n\n  load_years = function(){\n\n    $rootScope.makeOptions = [];\n    $rootScope.modelOptions = [];\n    $rootScope.categories = [];\n\n    $http.get(api_path + '/category_children', {params: {id: 2}} ).success(function(data) {\n      $rootScope.yearOptions = data;\n    }).error(function(data) {\n      $rootScope.yearOptions = [];\n    });\n  }\n\n  load_makes = function(){\n    $rootScope.makeOptions = [];\n    $rootScope.modelOptions = [];\n    $rootScope.categories = [];\n\n    $http.get(api_path + '/category_children', {params: {id: $rootScope.filter.year}} ).success(function(data) {\n      $rootScope.makeOptions = data;\n    }).error(function(data) {\n      $rootScope.makeOptions = [];\n    });\n  }\n\n  load_models = function(){\n    $rootScope.modelOptions = [];\n    $rootScope.categories = [];\n    $http.get(api_path + '/category_children', {params: {id: $rootScope.filter.make}} ).success(function(data) {\n      $rootScope.modelOptions = data;\n    }).error(function(data) {\n      $rootScope.modelOptions = [];\n    });\n  }\n\n  load_categories = function(){\n    $rootScope.categories = [];\n    $http.get(api_path + '/category_children', {params: {id: $rootScope.filter.model}} ).success(function(data) {\n      $rootScope.categories = data;\n    }).error(function(data) {\n      $rootScope.categories = [];\n    });\n  }\n\n  save_filter = function(){\n    jQuery.cookie('filter', $rootScope.filter);\n  }\n\n  $rootScope.set_category = function(category){\n    $rootScope.filter.category = category.id;\n    save_filter();\n  }\n\n  $rootScope.go = function(){\n    var category = find_object($rootScope.modelOptions, $rootScope.filter.model);\n\n    if(!category){\n      $rootScope.filter.model = null;\n      category = find_object($rootScope.makeOptions, $rootScope.filter.make);\n    }\n\n    if (category){\n      save_filter();\n      window.location.href = category.url;\n    }\n  }\n\n  $rootScope.$watch(\"yearOptions\", function(v, v1){\n    $rootScope.filterYear = find_object($rootScope.yearOptions, $rootScope.filter.year);\n  });\n\n  $rootScope.$watch(\"filter.year\", function(v, v1){\n\n    if(v){\n      $rootScope.filterYear = find_object($rootScope.yearOptions, v);\n      load_makes();\n    }\n  });\n\n\n  $rootScope.$watch(\"makeOptions.length\", function(v, v1){\n    $rootScope.filterMake = find_object($rootScope.makeOptions, $rootScope.filter.make);\n  });\n  \n  $rootScope.$watch(\"filter.make\", function(v, v1){\n    if (v){\n      $rootScope.filterMake = find_object($rootScope.makeOptions, v);\n      load_models();\n    }\n  });\n\n\n  $rootScope.$watch(\"modelOptions.length\", function(v, v1){\n    $rootScope.filterModel = find_object($rootScope.modelOptions, $rootScope.filter.model);\n  });\n\n  $rootScope.$watch(\"filter.model\", function(v, v1){\n    if (v){\n      $rootScope.filterModel = find_object($rootScope.modelOptions, v);\n      load_categories();\n    }\n  });\n\n  load_years();\n});"]}